#cloud-config
hostname: {{ vm_name }}
fqdn: {{ vm_name }}.{{ vm_base_domain }}

users:
{% for user in users %}
  - name: {{ user.username }}
    gecos: {{ user.fullname }}
    primary_group: {{ user.username }}
{% if user.is_admin | bool %}
    groups: wheel
    sudo: "ALL=(ALL) NOPASSWD:ALL"
{% else %}
    groups: users
{% endif %}
    shell: /bin/bash
    lock_passwd: true
    ssh_authorized_keys:
      - {{ user.ssh_public_key }}
{% endfor %}